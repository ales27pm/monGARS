# Cognition Engine Protocol

> ⚠️ Auto-generated by `scripts/manage_agents.py`. Update `configs/agents/agents_config.json` and rerun the script instead of editing this file manually.

## Scope

Guides orchestrators, schedulers, and memory abstractions under `monGARS/core/`.

## Automation

- Sourced from the central JSON profile; run the refresh command after substantial engine work.

## Roadmap Alignment

- **Performance & Resilience**
  - ✅ Worker auto-tuning for Pi/Jetson (`recommended_worker_count`).
  - ✅ Multi-architecture build scripts and cache metrics.
  - ✅ Hardened RBAC manifests.
  - ✅ Ray Serve HTTP integration with circuit breaking plus MNTP trainer support for LoRA and curated adapters.
  - ✅ Extend Alembic migrations for the newest SQLModel tables, including legacy tables created outside the current ORM layer.
  - ✅ Expose Ray Serve success/failure counters via OpenTelemetry (`llm.ray.*` metrics emitted by `LLMIntegration`).
- **Self-Improvement**
  - ✅ Personality profiles persisted via SQLModel with live adapter updates.
  - ✅ Self-training cycles produce real adapter artefacts via `modules.neurons.training.mntp_trainer.MNTPTrainer` with deterministic fallbacks.
  - ✅ Reinforcement-learning research loops run through the evolution orchestrator, operator approvals, and long-haul validator with telemetry and manifest updates.【F:modules/evolution_engine/orchestrator.py†L360-L440】【F:monGARS/core/long_haul_validation.py†L1-L220】
  - ✅ ResearchLongHaulService now schedules multi-replica soak runs and persists observability snapshots for dashboards, ensuring reinforcement pipelines stay healthy without manual triggers.【F:monGARS/core/research_validation.py†L1-L200】【F:monGARS/core/reinforcement_observability.py†L1-L168】【F:tests/test_research_long_haul_service.py†L1-L200】【F:tests/test_long_haul_validation.py†L200-L320】
- **Sustainability**
  - 🚧 Fully integrate evolution engine outputs into routine optimisation cycles.
  - 🚧 Automate energy usage reporting and advanced hardware-aware scaling using the energy tracker pipeline and reinforcement observability feeds as the baseline data source.【F:modules/evolution_engine/energy.py†L1-L160】【F:monGARS/core/reinforcement_observability.py†L1-L168】
  - 🚧 Share optimisation artefacts between nodes for faster convergence.

## Architectural Principles

- Keep orchestrators asynchronous, inject collaborators explicitly, and favour existing services
    (`AdaptiveResponseGenerator`, `ConversationalModule`, `PeerCommunicator`, `LongHaulValidation`)
    over ad-hoc state machines.
- Route UI events through `ui_events.event_bus`, persist approvals via `operator_approvals`, and
    coordinate sustainability metrics with `sustainability_dashboard` when adding new workflows.

## Operational Discipline

- Offload blocking work with `asyncio.to_thread` or executors and avoid sharing mutable globals across
    tasks.
- Emit metrics through `monGARS.telemetry`/OpenTelemetry where available and prefer timezone-aware
    timestamps (`datetime.now(datetime.UTC)`) in new code.
- Handle optional ML dependencies defensively with explicit fallbacks and structured warnings.

## Test Coverage

Expand cognition, reinforcement, and sustainability suites when behaviour
shifts—`tests/test_conversation_semantic_context.py`, `tests/test_llm_integration.py`,
`tests/test_peer_communication.py`, `tests/test_reinforcement_loop.py`,
`tests/test_long_haul_validation.py`, and `tests/test_sustainability_dashboard.py` anchor this area.

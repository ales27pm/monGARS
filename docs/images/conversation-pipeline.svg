<svg xmlns="http://www.w3.org/2000/svg" width="1024" height="600" viewBox="0 0 1024 600" role="img" aria-labelledby="title desc">
  <title id="title">Conversation pipeline</title>
  <desc id="desc">Flow showing authentication, validation, cognitive pipeline, and delivery for monGARS chat requests.</desc>
  <style>
    text { font-family: 'Inter', 'Segoe UI', sans-serif; fill: #111827; font-size: 17px; }
    .header { font-size: 20px; font-weight: 600; }
    rect { rx: 14; ry: 14; stroke-width: 2; }
    .stage { fill: #eef2ff; stroke: #6366f1; }
    .action { fill: #fef9c3; stroke: #ca8a04; }
    .persist { fill: #dcfce7; stroke: #16a34a; }
    .deliver { fill: #fee2e2; stroke: #ef4444; }
    line, path { stroke: #334155; stroke-width: 2; marker-end: url(#arrow); }
  </style>
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="8" refX="8" refY="4" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L8,4 L0,8 z" fill="#334155" />
    </marker>
  </defs>
  <rect x="60" y="70" width="220" height="120" class="stage" />
  <text x="80" y="110" class="header">Authenticate</text>
  <text x="80" y="145">OAuth2 password flow</text>
  <text x="80" y="171">JWT signed by SecurityManager</text>
  <rect x="320" y="70" width="260" height="120" class="stage" />
  <text x="340" y="110" class="header">Validate &amp; Sanitize</text>
  <text x="340" y="145">ChatRequest schema checks</text>
  <text x="340" y="171">Bleach HTML stripping</text>
  <rect x="620" y="50" width="320" height="160" class="action" />
  <text x="640" y="95" class="header">Cognitive Pipeline</text>
  <text x="640" y="125">CuriosityEngine researches gaps</text>
  <text x="640" y="151">LLMIntegration with Ray/Ollama</text>
  <text x="640" y="177">Personality &amp; Mimicry adaptation</text>
  <rect x="200" y="260" width="280" height="130" class="persist" />
  <text x="220" y="300" class="header">Persist &amp; Cache</text>
  <text x="220" y="332">SQLite + Hippocampus history</text>
  <text x="220" y="358">Adapter manifest refresh</text>
  <rect x="540" y="260" width="300" height="130" class="deliver" />
  <text x="560" y="300" class="header">Deliver</text>
  <text x="560" y="332">WebSocket broadcasts</text>
  <text x="560" y="358">HTTP response &amp; metrics</text>
  <line x1="280" y1="130" x2="320" y2="130" />
  <line x1="580" y1="130" x2="620" y2="130" />
  <path d="M780 210 C780 240 640 240 640 260" fill="none" />
  <line x1="340" y1="260" x2="340" y2="190" marker-end="url(#arrow)" />
  <line x1="480" y1="325" x2="540" y2="325" />
</svg>
